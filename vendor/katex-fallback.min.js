(function(){
  // Very small katex-like fallback renderer: does not parse TeX, only displays source nicely.
  window.katex = {
    render: function(latex, element, opts){
      // Simple fallback: set text content and mark as rendered
      element.innerText = latex;
      element.classList.add('katex-rendered');
    }
  };

  // Render math nodes inside a container: looks for .math-inline and .math-block
  window.renderMathInElement = function(root){
    if (!root) return;
    // inline
    const inlines = root.querySelectorAll('.math-inline');
    inlines.forEach(node => {
      const text = node.textContent || node.innerText || '';
      const span = document.createElement('span');
      span.className = 'katex-rendered katex-fallback';
      // remove surrounding $ if present
      const cleaned = text.replace(/^\$(.*)\$$/, '$1');
      span.innerText = cleaned;
      node.parentNode.replaceChild(span, node);
    });
    // block
    const blocks = root.querySelectorAll('.math-block');
    blocks.forEach(node => {
      const text = node.textContent || node.innerText || '';
      const div = document.createElement('div');
      div.className = 'katex-block katex-fallback';
      // remove surrounding $$ if present
      const cleaned = text.replace(/^\$\$(.*)\$\$$/s, '$1').trim();
      div.innerText = cleaned;
      node.parentNode.replaceChild(div, node);
    });
  };
})();
